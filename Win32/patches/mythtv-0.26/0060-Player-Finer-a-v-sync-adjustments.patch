From 74be3430f094ca65e4c2861e345872b654ea845d Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Fri, 12 Jul 2013 15:13:07 +0100
Subject: [PATCH 060/227] Player: Finer a/v sync adjustments

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/libs/libmythtv/mythplayer.cpp |   12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/mythtv/libs/libmythtv/mythplayer.cpp b/mythtv/libs/libmythtv/mythplayer.cpp
index 63dae4d..d36dbf1 100644
--- a/mythtv/libs/libmythtv/mythplayer.cpp
+++ b/mythtv/libs/libmythtv/mythplayer.cpp
@@ -2017,8 +2017,8 @@ void MythPlayer::AVSync(VideoFrame *buffer, bool limit_delay)
                     prevrp == 0)
                 {
                     // wait an extra frame interval
-                    LOG(VB_PLAYBACK | VB_TIMESTAMP, LOG_INFO, LOC +
-                        QString("A/V delay %1").arg(delta));
+                    LOG(VB_PLAYBACK, LOG_INFO, LOC +
+                        QString("Dropped frame. A/V delay %1mS").arg(delta));
                     avsync_adjustment += frame_interval;
                 }
             }
@@ -2041,12 +2041,16 @@ void MythPlayer::AVSync(VideoFrame *buffer, bool limit_delay)
                the video by one interlaced field (1/2 frame) */
             if (!lastsync)
             {
-                if (avsync_used > refreshrate)
+                if (avsync_used >= (4 * refreshrate) / 3)
                 {
+                    LOG(VB_PLAYBACK, LOG_DEBUG, LOC +
+                        "Video leads audio - wait a sync interval");
                     avsync_adjustment += refreshrate;
                 }
-                else if (avsync_used < 0 - refreshrate)
+                else if (avsync_used <= -(4 * refreshrate) / 3)
                 {
+                    LOG(VB_PLAYBACK, LOG_DEBUG, LOC +
+                        "Video lags audio - advance a sync interval");
                     avsync_adjustment -= refreshrate;
                 }
             }
-- 
1.7.9.5

