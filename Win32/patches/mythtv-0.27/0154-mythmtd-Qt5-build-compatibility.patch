From 8ac2fb99dfb20c2567f1dec171a74bff802c3c33 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Mon, 18 Mar 2013 12:48:21 +0000
Subject: [PATCH 154/207] mythmtd: Qt5 build compatibility

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/programs/mythmtd/main.cpp    |   24 +++++++++++++-----------
 mythtv/programs/mythmtd/mythmtd.pro |    7 +++++--
 2 files changed, 18 insertions(+), 13 deletions(-)

diff --git a/mythtv/programs/mythmtd/main.cpp b/mythtv/programs/mythmtd/main.cpp
index f76ea63..01ad31b 100644
--- a/mythtv/programs/mythmtd/main.cpp
+++ b/mythtv/programs/mythmtd/main.cpp
@@ -16,6 +16,7 @@ using std::cerr;
 #include <QApplication>
 #include <QSqlDatabase>
 #include <QFile>
+#include <QStringList>
 
 #include <exitcodes.h>
 #include <mythcontext.h>
@@ -38,24 +39,25 @@ int main(int argc, char **argv)
     //  Check command line arguments
     //
 
-    for (int argpos = 1; argpos < a.argc(); ++argpos)
+    QStringList args = a.arguments();
+    for (int argpos = 1; argpos < args.size(); ++argpos)
     {
-        if (!strcmp(a.argv()[argpos],"-d") ||
-            !strcmp(a.argv()[argpos],"--daemon"))
+        if (!strcmp(qPrintable(args[argpos]),"-d") ||
+            !strcmp(qPrintable(args[argpos]),"--daemon"))
         {
             daemon_mode = true;
         }
-        else if (!strcmp(a.argv()[argpos],"-n") ||
-                 !strcmp(a.argv()[argpos],"--nodaemon"))
+        else if (!strcmp(qPrintable(args[argpos]),"-n") ||
+                 !strcmp(qPrintable(args[argpos]),"--nodaemon"))
         {
             daemon_mode = false;
         }
-        else if (!strcmp(a.argv()[argpos],"-p") ||
-                 !strcmp(a.argv()[argpos],"--port"))
+        else if (!strcmp(qPrintable(args[argpos]),"-p") ||
+                 !strcmp(qPrintable(args[argpos]),"--port"))
         {
-            if (a.argc() > argpos)
+            if (args.size() > argpos)
             {
-                QString port_number = a.argv()[argpos+1];
+                QString port_number = args[argpos+1];
                 ++argpos;
                 special_port = port_number.toInt();
                 if (special_port < 1 ||
@@ -71,7 +73,7 @@ int main(int argc, char **argv)
                 return GENERIC_EXIT_INVALID_CMDLINE;
             }
         }
-        else if (!strcmp(a.argv()[argpos],"-v"))
+        else if (!strcmp(qPrintable(args[argpos]),"-v"))
         {
             if (++argpos >= argc) {
                 cerr << "Error: -v requires parameters (try -v help)" <<
@@ -89,7 +91,7 @@ int main(int argc, char **argv)
         }
         else
         {
-            cerr << "Invalid argument: " << a.argv()[argpos] << endl
+            cerr << "Invalid argument: " << qPrintable(args[argpos]) << endl
                  << "Valid options are: " << endl
                  << "-p or --port number  "
                  << "A port number to listen on (default is 2442) " << endl
diff --git a/mythtv/programs/mythmtd/mythmtd.pro b/mythtv/programs/mythmtd/mythmtd.pro
index 06578c0..4dc408b 100644
--- a/mythtv/programs/mythmtd/mythmtd.pro
+++ b/mythtv/programs/mythmtd/mythmtd.pro
@@ -3,19 +3,22 @@ include ( ../../version.pro )
 include ( ../programs-libs.pro )
 
 QT += sql xml network
+contains(QT_VERSION, ^5\\.[0-9]\\..*) {
+QT += widgets
+}
 
 TEMPLATE = app
 CONFIG += thread opengl
 target.path = $${PREFIX}/bin
 INSTALLS += target
 
-HEADERS += libmythtv/videodbcheck.h logging.h mtd.h
+HEADERS += ../../libs/libmythtv/videodbcheck.h logging.h mtd.h
 HEADERS += jobthread.h dvdprobe.h fileobs.h threadevents.h
 
 LIBS += -L../../libs/libmythdvdnav
 LIBS += -lmythdvdnav-$$LIBVERSION
 
-SOURCES += main.cpp libmythtv/videodbcheck.cpp logging.cpp mtd.cpp
+SOURCES += main.cpp ../../libs/libmythtv/videodbcheck.cpp logging.cpp mtd.cpp
 SOURCES += jobthread.cpp dvdprobe.cpp fileobs.cpp threadevents.cpp
 
 mingw:DEFINES += USING_MINGW
-- 
1.7.9.5

