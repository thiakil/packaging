From e0fef3bf57532190306469182bff5e7e1c46bd02 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Sat, 29 Oct 2011 11:24:57 +0200
Subject: [PATCH 095/202] dvbrecorder: Correct test for MPEG TS continuity
 counter

The transport stream continuity counter is only incremented iff the packet
has a payload.  This change only reports a continuity error iff the
packet has a payload.

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/libs/libmythtv/recorders/dtvrecorder.cpp |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/mythtv/libs/libmythtv/recorders/dtvrecorder.cpp b/mythtv/libs/libmythtv/recorders/dtvrecorder.cpp
index d7c2b75..e178b42 100644
--- a/mythtv/libs/libmythtv/recorders/dtvrecorder.cpp
+++ b/mythtv/libs/libmythtv/recorders/dtvrecorder.cpp
@@ -1330,7 +1330,7 @@ bool DTVRecorder::ProcessTSPacket(const TSPacket &tspacket)
 
     // Check continuity counter
     uint old_cnt = _continuity_counter[pid];
-    if ((pid != 0x1fff) && !CheckCC(pid, tspacket.ContinuityCounter()))
+    if ((pid != 0x1fff) && tspacket.HasPayload() && !CheckCC(pid, tspacket.ContinuityCounter()))
     {
         int v = _continuity_error_count.fetchAndAddRelaxed(1) + 1;
         double erate = v * 100.0 / _packet_count.fetchAndAddRelaxed(0);
@@ -1434,7 +1434,7 @@ bool DTVRecorder::ProcessAVTSPacket(const TSPacket &tspacket)
 
     // Check continuity counter
     uint old_cnt = _continuity_counter[pid];
-    if ((pid != 0x1fff) && !CheckCC(pid, tspacket.ContinuityCounter()))
+    if ((pid != 0x1fff) && tspacket.HasPayload() && !CheckCC(pid, tspacket.ContinuityCounter()))
     {
         int v = _continuity_error_count.fetchAndAddRelaxed(1) + 1;
         double erate = v * 100.0 / _packet_count.fetchAndAddRelaxed(0);
-- 
1.7.9.5

