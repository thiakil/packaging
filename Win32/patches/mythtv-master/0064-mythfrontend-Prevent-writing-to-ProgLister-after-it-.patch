From 38d83520108cc6b3469baf1a8aea1cedc99d1fc0 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Tue, 8 Nov 2011 20:01:05 +0100
Subject: [PATCH 064/202] mythfrontend: Prevent writing to ProgLister after
 it's deleted,

ProgLister::keyPressEvent passes unhanded events to
MythScreenType::keyPressEvent.  These events include ESC which can close
the screen and delete the object.  This patch ensures that the object
is not read or writtem after MythScreenType::keyPressEvent is called.

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/programs/mythfrontend/proglist.cpp |    6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/mythtv/programs/mythfrontend/proglist.cpp b/mythtv/programs/mythfrontend/proglist.cpp
index 7c111c1..d776fe4 100644
--- a/mythtv/programs/mythfrontend/proglist.cpp
+++ b/mythtv/programs/mythfrontend/proglist.cpp
@@ -300,15 +300,13 @@ bool ProgLister::keyPressEvent(QKeyEvent *e)
         }
     }
 
-    if (!handled && MythScreenType::keyPressEvent(e))
-        handled = true;
-
     if (needUpdate)
         LoadInBackground();
 
     m_allowEvents = true;
 
-    return handled;
+    // CAUTION: MythScreenType::keyPressEvent(ESCAPE) deletes this object
+    return handled ? true : MythScreenType::keyPressEvent(e);
 }
 
 void ProgLister::ShowMenu(void)
-- 
1.7.9.5

