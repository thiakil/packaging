From c79e42c135172e8f63480a3fe1b4257d2cf02947 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Thu, 22 Aug 2013 09:07:58 +0100
Subject: [PATCH 279/285] NVR: Prevent a divide by 0 and arithmetic exception

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/libs/libmythtv/NuppelVideoRecorder.cpp |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/mythtv/libs/libmythtv/NuppelVideoRecorder.cpp b/mythtv/libs/libmythtv/NuppelVideoRecorder.cpp
index 9a93403..e8409ba 100644
--- a/mythtv/libs/libmythtv/NuppelVideoRecorder.cpp
+++ b/mythtv/libs/libmythtv/NuppelVideoRecorder.cpp
@@ -1,6 +1,7 @@
 #include <cstdio>
 #include <cstdlib>
 #include <fcntl.h>
+#include <limits.h>
 #include <unistd.h>
 #include <sys/types.h>
 #include <sys/stat.h>
@@ -3320,10 +3321,10 @@ void NuppelVideoRecorder::WriteAudio(unsigned char *buf, int fnum, int timecode)
                                      // wrong guess ;-)
         // need seconds instead of msec's
         mt = (double)timecode;
-        if (mt > 0.0)
+        if (mt > 0.0 && audio_bytes_per_sample)
         {
             eff = (abytes / mt) * (100000.0 / audio_bytes_per_sample);
-            effectivedsp = (int)eff;
+            effectivedsp = (eff <= INT_MAX) ? (int)eff : INT_MAX;
         }
     }
 
-- 
1.7.9.5

