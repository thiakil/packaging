From ea6809ce08e67753be7a7ad1dd71d76bc320ec54 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Sun, 3 Jun 2012 12:23:12 +0200
Subject: [PATCH 120/285] libmyth: Prevent a SEGV in mythwelcome when backend
 connection reestablished

Mythwelcome can suffer a SEGV if it receives a CONNECTION_RESTABLISHED
MythEvent which races with a user close event.

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/libs/libmyth/mythcontext.cpp |   11 ++++-------
 1 file changed, 4 insertions(+), 7 deletions(-)

diff --git a/mythtv/libs/libmyth/mythcontext.cpp b/mythtv/libs/libmyth/mythcontext.cpp
index 12ba13e..8d9bc38 100644
--- a/mythtv/libs/libmyth/mythcontext.cpp
+++ b/mythtv/libs/libmyth/mythcontext.cpp
@@ -95,10 +95,8 @@ class MythContextPrivate : public QObject
 
     void ShowConnectionFailurePopup(bool persistent);
     void HideConnectionFailurePopup(void);
-    void ConnectFailurePopupClosed(void);
 
     void ShowVersionMismatchPopup(uint remoteVersion);
-    void VersionMismatchPopupClosed(void);
 
   public:
     MythContext *parent;
@@ -1249,11 +1247,10 @@ void MythContextPrivate::ShowConnectionFailurePopup(bool persistent)
 
 void MythContextPrivate::HideConnectionFailurePopup(void)
 {
-    if (MBEconnectPopup)
-    {
-        MBEconnectPopup->Close();
-        MBEconnectPopup = NULL;
-    }
+    MythConfirmationDialog *dlg = this->MBEconnectPopup;
+    this->MBEconnectPopup = NULL;
+    if (dlg)
+        dlg->Close();
 }
 
 void MythContextPrivate::ShowVersionMismatchPopup(uint remote_version)
-- 
1.7.9.5

