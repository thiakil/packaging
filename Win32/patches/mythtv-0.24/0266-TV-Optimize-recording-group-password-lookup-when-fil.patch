From 03c14de6184f958d4c271a5660ad5832f10401d5 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Fri, 2 Aug 2013 19:08:12 +0100
Subject: [PATCH 266/285] TV: Optimize recording group password lookup when
 filling OSD

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/libs/libmythtv/tv_play.cpp |   21 +++++++++++----------
 1 file changed, 11 insertions(+), 10 deletions(-)

diff --git a/mythtv/libs/libmythtv/tv_play.cpp b/mythtv/libs/libmythtv/tv_play.cpp
index 05fa952..2831910 100644
--- a/mythtv/libs/libmythtv/tv_play.cpp
+++ b/mythtv/libs/libmythtv/tv_play.cpp
@@ -10862,6 +10862,7 @@ void TV::FillOSDMenuJumpRec(PlayerContext* ctx, const QString category,
                     SetLastProgram(plist[0]);
                     if (!PromptRecGroupPassword(ctx))
                         continue;
+                    currecgroup = lastProgram->GetRecordingGroup();
                 }
 
                 if (progIndex == 1 && level == 0)
@@ -11769,17 +11770,17 @@ bool TV::PromptRecGroupPassword(PlayerContext *ctx)
     if (!lastProgram)
         return false;
 
-    bool paused = ContextIsPaused(ctx, __FILE__, __LINE__);
-    bool stayPaused = paused;
-    if (!paused)
-        DoTogglePause(ctx, false);
-    QString recGroupPassword;
-    lastProgram->SetRecordingGroup(lastProgram->QueryRecordingGroup());
-    recGroupPassword = ProgramInfo::QueryRecordingGroupPassword(
+    //lastProgram->SetRecordingGroup(lastProgram->QueryRecordingGroup());
+    QString recGroupPassword = ProgramInfo::QueryRecordingGroupPassword(
         lastProgram->GetRecordingGroup());
 
     if (recGroupPassword.size())
     {
+        bool paused = ContextIsPaused(ctx, __FILE__, __LINE__);
+        bool stayPaused = paused;
+        if (!paused)
+            DoTogglePause(ctx, false);
+
         //qApp->lock();
         bool ok = false;
         QString text = tr("'%1' Group Password:")
@@ -11801,10 +11802,10 @@ bool TV::PromptRecGroupPassword(PlayerContext *ctx)
 
             return false;
         }
-    }
 
-    if (ContextIsPaused(ctx, __FILE__, __LINE__) && !stayPaused)
-        DoTogglePause(ctx, false);
+        if (ContextIsPaused(ctx, __FILE__, __LINE__) && !stayPaused)
+            DoTogglePause(ctx, false);
+    }
 
     return true;
 }
-- 
1.7.9.5

