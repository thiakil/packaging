From ab75be8427e3d3d3f1c20501419e1778cd8a6a87 Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Thu, 27 Jun 2013 11:46:08 +0100
Subject: [PATCH 238/285] Netstream: Improve logging of streams with no
 content length header

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
---
 mythtv/libs/libmythtv/netstream.cpp |    9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/mythtv/libs/libmythtv/netstream.cpp b/mythtv/libs/libmythtv/netstream.cpp
index d461e8e..27be597 100644
--- a/mythtv/libs/libmythtv/netstream.cpp
+++ b/mythtv/libs/libmythtv/netstream.cpp
@@ -375,8 +375,10 @@ void NetStream::slotReadyRead()
             else
             {
                 m_size = ContentLength(m_reply);
-                VERBOSE(VB_FILE, LOC + QString("(%1) Ready 0x%2, content length %3")
-                    .arg(m_id).arg(quintptr(m_reply),0,16).arg(m_size) );
+                if (m_state < kReady || m_size >= 0)
+                    VERBOSE(VB_FILE, LOC +
+                        QString("(%1) Ready 0x%2, content length %3")
+                        .arg(m_id).arg(quintptr(m_reply),0,16).arg(m_size) );
             }
         }
 
@@ -438,6 +440,9 @@ void NetStream::slotFinished()
 
         if (m_state == kFinished)
         {
+            if (m_size < 0)
+                m_size = m_pos + m_reply->size();
+
             VERBOSE(VB_FILE, LOC + QString("(%1) Finished 0x%2 %3/%4 bytes from %5")
                 .arg(m_id).arg(quintptr(m_reply),0,16).arg(m_pos).arg(m_size).arg(Source(m_reply)) );
 
-- 
1.7.9.5

